<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pulmuone</title>
    <style media="screen">
      body { margin:0px; padding:0px; }
    </style>
</head>
<body>
</body>
<script type="text/javascript" src="./js/phaser.min.js"></script>
<script type="text/javascript">

    var configuration = {
    'canvas_width_max' : 2048,
    'canvas_width' : 360,
    'canvas_height_max' : 2048,
    'canvas_height' : 640,
    'scale_ratio' : 1,
    'aspect_ratio' : 1,
    };
    var isMobile = (/iphone|ipod|android|ie|blackberry|fennec/).test(navigator.userAgent.toLowerCase());
    var gameWidth = 360;
    var gameHeight = 640;
    if(isMobile){
      gameWidth = window.innerWidth;
      gameHeight = window.innerHeight;
    }
    configuration.canvas_width = window.screen.availWidth * window.devicePixelRatio;
    configuration.canvas_height = window.screen.availHeight * window.devicePixelRatio;
    configuration.aspect_ratio = configuration.canvas_width / configuration.canvas_height;
    if(isMobile){
      var isApple = (/iphone|ipod/).test(navigator.userAgent.toLowerCase());
      if(isApple) {
        if (configuration.aspect_ratio < 1)
          configuration.scale_ratio = (configuration.canvas_height / configuration.canvas_height_max)*1.5;
        else
          configuration.scale_ratio = configuration.canvas_width / configuration.canvas_width_max;
      } else {
        if (configuration.aspect_ratio < 1)
          configuration.scale_ratio = (configuration.canvas_height / configuration.canvas_height_max)*1.2;
        else
          configuration.scale_ratio = configuration.canvas_width / configuration.canvas_width_max;
      }

    } else {
      configuration.scale_ratio = 0.5;
    }

    var game = new Phaser.Game(gameWidth,gameHeight, Phaser.CANVAS,  'game', {
        preload: preload,
        create: create,
        update: update,
        render: render,
    });

    // this.game.scale.fullScreenScaleMode = Phaser.ScaleManager.SHOW_ALL;
    // this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    // this.game.scale.refresh();
    var blank_bg;
    var loading;
    var loading_btn;
    var start; // 로고 화면
    var logo;// 시작 화면 logo sprite
    var title_sprite; // 시작 화면 캐릭터 sprite
    var firstBg; //로고 화면 버튼 기능을 할 투명한 배경
    var firstBtn; // touch to start image
    var muteBtn_on; // 음소거 버튼(활성화)
    var muteBtn_off; // 음소거 버튼(비활성화)
    var inst_bg; //게임 시작 전 화면 배경
    var inst_1; //게임 시작 전 화면 배경
    var inst_2; //게임 시작 전 화면 배경
    var inst_3; //게임 시작 전 화면 배경
    var startBtn; //시작버튼
    var bg; // 게임 배경 이미지
    var box; // 그룹 형성용 이미지
    var player // 플레이어
    var enemy; // 회피물
    var enemyAlive; // 회피물 존재 여부
    var enemyArray = []; // 생성될 회피물의 정보
    var life = 1; // 플레이어 생명
    var timer; // 타이머
    var timerEvent; // 타이머 이벤트
    var score; // 점수
    var txtScore;
    var eventScore;
    var img_1; //1
    var img_2; //2
    var img_3; //3
    var img_GO; //GO!
    var isHit = false; //충돌 유무 확인
    var clear; //성공 애니메이션
    var clear_1; //성공 캐릭터 1
    var clear_2; //성공 캐릭터 2
    var clear_bg; //성공 빵빠레
    var fail; // 실패 애니메이션
    var fail_1; // 실패 캐릭터 1
    var fail_bg; // 실패 배경
    var basketBtn; // 장바구니 확인 버튼
    var basket_board; // 장바구니 배경 이미지
    var basket_1; // 장바구니 아이템 1
    var basket_2; // 장바구니 아이템 2
    var basket_3; // 장바구니 아이템 3
    var basket_4; // 장바구니 아이템 4
    var basket_5; // 장바구니 아이템 5
    var basket_6; // 장바구니 아이템 6
    var basket_7; // 장바구니 아이템 7
    var resultBtn; // 결과창 이동 버튼
    var level1;
    var level2;
    var level3;
    var level4;
    var level5;
    var level6;
    var finalScore;//최종점수
    var final_text_1;
    var final_text_2;
    var restartBtn;
    var good = true;
    var a_123;
    var a_button8;
    var a_fail;
    var a_game_bgm;
    var a_go;
    var a_object;
    var a_start;
    var a_success;
    var linkBtn_1;
    var linkBtn_2;
    var linkBtn_3;
    var firstBtnBlink;
    var group_muteBtn;// mute on/off button always one top;
    var basket_left;
    var basket_right;
    var restart_1; // 장바구니 카운트1
    var restart_2; // 장바구니 카운트1
    var restart_3; // 장바구니 카운트1
    var restart_4; // 장바구니 카운트1
    var restart_5; // 장바구니 카운트1
    var restart; // 재시작 버튼


    /* -----PRELOAD----- */
    function preload() {
        //게임에 필요한 데이터 로드
        /* 게임 시작전 화면 이미지 로드 */
        game.load.image("blank_bg", "./images/blank_bg.png");
        game.load.spritesheet("loading", "./images/loading.png", 720, 1280);
        game.load.image("loading_btn", "./images/loading_btn.png");

        game.load.spritesheet("logo", "./images/logo.png", 553, 269);
        game.load.spritesheet("title_sprite", "./images/title_sprite.png", 720, 650);
        game.load.image("firstBg", "./images/firstBg.png");
        game.load.image("firstBtn", "./images/firstBtn.png");
        game.load.image("muteBtn_on", "./images/muteBtn_on.png");
        game.load.image("muteBtn_off", "./images/muteBtn_off.png");
        game.load.image("inst_bg", "./images/inst_bg.png");
        game.load.image("inst_1", "./images/inst_1.png");
        game.load.image("inst_2", "./images/inst_2.png");
        game.load.image("inst_3", "./images/inst_3.png");
        game.load.image("startBtn", "./images/startBtn.png");
        /* 배경 이미지 로드 */
        game.load.image("background", "./images/background.png");
        /* 그룹 형성 시에 사용할 박스 이미지 로드 */
        game.load.image("box", "./images/box.png");
        /* 플레이어를 기본 32x40 크기로 설정. 'player' 이름으로 생성 */
        game.load.spritesheet("player", "./images/player.png", 256, 256);
        /* 카운트다운 이미지 로드 */
        game.load.spritesheet("img_1", "./images/count/img_1.png",228,228);
        game.load.spritesheet("img_2", "./images/count/img_2.png",228,228);
        game.load.spritesheet("img_3", "./images/count/img_3.png",228,228);
        game.load.spritesheet("img_GO", "./images/count/img_GO.png",228,228);
        /* 아이템 로드 */
        game.load.image("item_1", "./images/items/1.png");
        game.load.image("item_2", "./images/items/2.png");
        game.load.image("item_3", "./images/items/3.png");
        game.load.image("item_4", "./images/items/4.png");
        game.load.image("item_5", "./images/items/5.png");
        game.load.image("item_6", "./images/items/6.png");
        game.load.image("item_7", "./images/items/7.png");
        game.load.image("trash", "./images/items/trash.png");
        game.load.image("jadamteo", "./images/items/jadamteo.png");

        /* 게임오버 이미지 로드 */
        game.load.spritesheet("clear", "./images/clear.png",560,390);
        game.load.image("clear_1", "./images/clear_1.png");
        game.load.image("clear_2", "./images/clear_2.png");
        game.load.image("clear_bg", "./images/clear_bg.png");
        game.load.spritesheet("fail", "./images/fail.png",317,194);
        game.load.image("fail_1", "./images/fail_1.png");
        game.load.image("fail_bg", "./images/fail_bg.png");

        /* 바구니 확인 버튼 로드 */
        game.load.image("basketBtn", "./images/basketBtn.png");
        /* 바구니 확인 board 로드 */
        game.load.image("basket_board", "./images/basket_board.png");
        /* 장바구니 아이템 로드 */
        game.load.image("basket_1", "./images/basket/basket_1.png");
        game.load.image("basket_2", "./images/basket/basket_2.png");
        game.load.image("basket_3", "./images/basket/basket_3.png");
        game.load.image("basket_4", "./images/basket/basket_4.png");
        game.load.image("basket_5", "./images/basket/basket_5.png");
        game.load.image("basket_6", "./images/basket/basket_6.png");
        game.load.image("basket_7", "./images/basket/basket_7.png");
        /* 제품보러가기 버튼 로드 */
        game.load.image("linkBtn", "./images/linkBtn.png");

        /* 결과창 이동 버튼 로드 */
        game.load.spritesheet("resultBtn", "./images/resultBtn.png",336,127);
        /* 장바구니 페이지 이동 버튼 */
        game.load.image("basket_left", "./images/basket_left.png");
        game.load.image("basket_right", "./images/basket_right.png");


        /* 재시작 버튼 추가 */
        game.load.image("restart_1", "./images/result/1.png");
        game.load.image("restart_2", "./images/result/2.png");
        game.load.image("restart_3", "./images/result/3.png");
        game.load.image("restart_4", "./images/result/4.png");
        game.load.image("restart_5", "./images/result/5.png");
        game.load.image("restart", "./images/result/restart.png");



        /* 효과음 로드*/
        game.load.audio('123', './audio/123.mp3');
        game.load.audio('button8', './audio/button8.wav');
        game.load.audio('fail', './audio/fail.mp3');
        game.load.audio('game_bgm', './audio/game_bgm.mp3');
        game.load.audio('go', './audio/go.mp3');
        game.load.audio('object', './audio/object.mp3');
        game.load.audio('start', './audio/start.mp3');
        game.load.audio('success', './audio/success.mp3');
    }




    /* -----CREATE----- */
    function create() {

        /* 게임 처음 실행 시 수행되는 함수 */
        game.physics.startSystem(Phaser.Physics.ARCADE);
        score = parseFloat(0);
        /* 음악설정 */
        a_123 = game.add.audio('123');
        a_button8 = game.add.audio('button8');
        a_fail = game.add.audio('fail');
        a_game_bgm = game.add.audio('game_bgm');
        a_go = game.add.audio('go');
        a_object = game.add.audio('object');
        a_start = game.add.audio('start',1,true);
        a_success = game.add.audio('success');

        bg = game.add.sprite(0, 0, "background");
        bg.width =gameWidth;
        bg.height =gameHeight;
        bg.visible = false;

        blank_bg = game.add.sprite(0,0,'blank_bg');
        blank_bg.width = gameWidth;
        blank_bg.height = gameHeight;



        loading = game.add.sprite(0,0,'loading');
        loading.width = gameWidth;
        loading.height = gameHeight;
        loading.animations.add('start',[0,1,2,3,4,6,7,8,9,10,11,12,13,14,15,16],10,true);
        loading.animations.play('start');

        setTimeout(function() {
          loading.destroy();
          loading_btn = game.add.button(0, 0, "loading_btn", loadingBtnClick, this, 1, 1, 0
          );
          loading_btn.width = gameWidth;
          loading_btn.height = gameHeight;
        }, 2900);

        // create a custom time
        timer = game.time.create();

        // create a delayed event 1m and 30s from now
        timerEvent = timer.add(Phaser.Timer.MINUTE * 1, endTimer, this);
        // timerEvent = timer.add(Phaser.Timer.SECOND * 1, endTimer, this);


        /* box 그룹 생성 */
        box = game.add.group();
        box.enableBody = true; // box에 출돌속성을 설정.

        /* 회피물 생성 */
        enemy = game.add.group();


        /* Game Over */


        /* Score */
        var textScale;
        if(isMobile) {
          txtScore= game.add.text(10, 10, 'Score: 0', { font: '64pt Arial', fill: '#ffffff' });
        } else {
          txtScore= game.add.text(10, 10, 'Score: 0', { font: '32pt Arial', fill: '#ffffff' });
        }
        txtScore.position.x = game.world.centerX-(txtScore.width/2)
        txtScore.visible = false;

        this.stage.disableVisibilityChange = true;
    }



    /* -----UPDATE----- */
    function update() {
        /*  프레임워크에서 주기적으로 수행하는 함수 */
        if (life < 1) {
          player.visible=false;
          enemy.visible=false;
          txtScore.visible=false;
          return;
        }
        /* box 밖으로의 움직임 제한 */
        game.physics.arcade.collide(player, box);

        game.physics.arcade.overlap(player, enemy, enemyHitsPlayer, null, this);

        /* 플레이어 움직임 정의 */
        if (player != undefined) {
            player.body.velocity.setTo(0, 0); // 관성을 0으로 설정

            //  400 is the speed it will move towards the mouse
            //game.physics.arcade.moveToPointer(player, 400);
            game.physics.arcade.moveToXY(player, game.input.x, game.height, 4000);
            if (isHit) {
              if(good) {
                player.animations.play("good");
              } else {
                player.animations.play("bad");
              }
            } else if (game.input.mousePointer.x > player.x || game.input.mousePointer.x < player.x) {
                player.animations.play("run");
            } else {
                //player.animations.stop();
                // player.frame = 3;
            }
        }




        // if (enemy != undefined) {
        if (false) {
            /* 회피물 세팅 */
            enemyAlive = enemy.getFirstExists(false);
            enemyArray.length = 0;
            // box 개수 만큼 회피물을 세팅
            box.forEachAlive(function(enemyAlive) {
                enemyArray.push(enemyAlive);
            });
            // box 중 랜덤으로 하나를 골라서 회피물 생성
            if (enemyAlive && enemyArray.length > 0) {
                var random = game.rnd.integerInRange(0, enemyAlive.length - 1);
                var enemyBox = enemyArray[random];
                enemyAlive.reset(game.rnd.integerInRange(0, game.width), 80);
                game.physics.arcade.moveToXY(enemyAlive, enemyAlive.x, game.height, 150);
            }
        }
    }
    function endTimer() {
        // Stop the timer when the delayed event triggers
        timer.stop();
        a_game_bgm.stop();
        finalScore = score;
        life = 0;
        if(finalScore >= 100){
        // if(false){
          a_success.play();
          clear_bg = game.add.sprite(0, 0,'clear_bg');
          clear_bg.width = gameWidth;
          clear_bg.height = gameHeight;
          clear = game.add.sprite(game.world.centerX,game.world.height/5,'clear');
          clear.scale.setTo(configuration.scale_ratio);
          clear.position.x -= clear.width/2;
          clear.position.y -= clear.height/2;
          clear.animations.add('start',[0,1,2,3,4,5],20,false);
          clear.animations.play('start');
          clear_1 = game.add.sprite(game.world.centerX, game.world.centerY,'clear_1');
          clear_1.scale.setTo(configuration.scale_ratio);
          clear_1.position.x -= clear_1.width/2;
          clear_1.position.y -= clear_1.height/2;
          setTimeout(
            function() {
              clear_1.destroy();
              clear_2 = game.add.sprite(game.world.centerX, game.world.centerY,'clear_2');
              clear_2.scale.setTo(configuration.scale_ratio);
              clear_2.position.x -= clear_2.width/2;
              clear_2.position.y -= clear_2.height/2;
            }, 1000
          );
        } else {
          a_fail.play();
          fail_bg = game.add.sprite(0, 0,'fail_bg');
          fail_bg.width = gameWidth;
          fail_bg.height = gameHeight;
          fail =  game.add.sprite(game.world.centerX,game.world.height/5,'fail');
          fail.scale.setTo(configuration.scale_ratio);
          fail.position.x -= fail.width/2;
          fail.position.y -= fail.height/2;
          fail.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10],20,false);
          fail.animations.play('start');
          fail_1 = game.add.sprite(game.world.centerX, game.world.centerY,'fail_1');
          fail_1.scale.setTo(configuration.scale_ratio*1.5);
          fail_1.position.x -= fail_1.width/2;
          fail_1.position.y -= fail_1.height/2;
        }

        setTimeout(
            function() {
                basketBtn = game.add.button(
                    game.world.centerX , game.height * 0.8, "basketBtn", basketBtnClick, this, 1, 1, 0
                );
                basketBtn.scale.setTo(configuration.scale_ratio);
                basketBtn.position.x -= basketBtn.width/2;
            }, 1500);
    };

    /* -----RENDER----- */
    function render() {
        if (timer.running) {
            // If our timer is running, show the time in a nicely formatted way,fontSize:"70px Arial",fill: "#FFFFFF"}
            game.debug.text(formatTime(Math.round((timerEvent.delay - timer.ms) / 1000)), game.width-70, 25, "#ffffff");
        } else {
            // else show 'Done'!;

        }
    }


    /* -----FORMATTIMER----- */
    function formatTime(s) {
        //convert seconds (s) to a nicely formatted and padded time string
        var minutes = "0" + Math.floor(s / 60);
        var seconds = "0" + (s - minutes * 60);
        return minutes.substr(-2) + ":" + seconds.substr(-2);
    }

    /**
      최종 점수를 리턴
    */
    function getFinalScore() {
      return finalScore;
    }

    function enemyHitsPlayer(playerPoint, enemy) {
      a_object.play();
        var input = parseInt(enemy['score']);
        enemy.kill();
        isHit = true;

        if(input>0) {
          good=true;
        } else {
          good=false;
        }
        //20 만큼 점프
        //player.y = game.height-30;
        //life = 0;

        score = parseInt(input)+parseInt(score);
        txtScore.setText("Score: " + score);
        setTimeout(function() {
            isHit = false;
        }, 500);
    }

    function loadingBtnClick() {
      blank_bg.destroy();
      loading_btn.destroy();
      /* 배경화면 설정 */
      bg.visible = true;

      a_start.play();

      logo = game.add.sprite(game.world.centerX,game.world.height/8,'logo');
      logo.scale.setTo(configuration.scale_ratio);

      logo.position.x -= logo.width/2;
      logo.animations.add('start',[0,1,2,3,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19],10,false);
      logo.animations.play('start');

      title_sprite = game.add.sprite(game.world.centerX,game.world.height*0.6,'title_sprite');
      title_sprite.scale.setTo(configuration.scale_ratio/1.5);
      title_sprite.position.x -= title_sprite.width/2;
      title_sprite.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],30,true);
      title_sprite.animations.play('start');

      setTimeout(function() {
        firstBg = game.add.button(0, 0, "firstBg", firstBtnClick, this, 1, 1, 0
        );
        firstBtn = game.add.sprite(game.world.centerX,game.height*0.93,'firstBtn');
        firstBtn.scale.setTo(configuration.scale_ratio);
        firstBtn.x -= firstBtn.width/2;

          firstBg.width = gameWidth;
          firstBg.height = gameHeight;
      }, 2200);

      firstBtnBlink = setInterval(
          function() {
            if(firstBtn != undefined) {
              var i = 0;
              if(firstBtn.visible) {
                firstBtn.visible = false;
              } else {
                firstBtn.visible = true;
              }
            }
            if(group_muteBtn != undefined)
              game.world.bringToTop(group_muteBtn);
          }, 600
      );
      group_muteBtn = game.add.group();

      /* 음소거 버튼 설정 */
      muteBtn_on = game.add.button(
          game.width
          , 10
          , "muteBtn_on", muteBtn_onClick, this, 1, 1, 0
      );
      muteBtn_on.scale.setTo(configuration.scale_ratio);
      muteBtn_on.x -= (muteBtn_on.width)+10
      muteBtn_on.visible = false;

      muteBtn_off = game.add.button(
          game.width
          , 10
          , "muteBtn_off", muteBtn_offClick, this, 1, 1, 0
      );
      muteBtn_off.scale.setTo(configuration.scale_ratio);
      muteBtn_off.x -= (muteBtn_off.width)+10

      group_muteBtn.add(muteBtn_on);
      group_muteBtn.add(muteBtn_off);
      game.world.bringToTop(group_muteBtn);

    }

    function firstBtnClick() {
        destroy(firstBtnBlink);
        a_start.stop();
        a_button8.play();
        logo.destroy();
        title_sprite.destroy();
        firstBtn.destroy();
        firstBg.destroy();
        muteBtn_on.destroy();
        muteBtn_off.destroy();

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          inst_bg = game.add.sprite(game.world.centerX,gameHeight/16,'inst_bg');
          inst_bg.scale.setTo(configuration.scale_ratio);
          inst_bg.x -= inst_bg.width/2;
        }, 700);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_1 = game.add.sprite(game.world.centerX,game.height/16,'inst_1');
          inst_1.scale.setTo(configuration.scale_ratio);
          inst_1.x -= inst_1.width/2;
          inst_1.y = inst_bg.y+(inst_bg.height/3.5);
        }, 700*2);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_2 = game.add.sprite(game.world.centerX,game.height/16,'inst_2');
          inst_2.scale.setTo(configuration.scale_ratio);
          inst_2.x -= inst_2.width/2;
          inst_2.y = inst_1.y+inst_1.height+(inst_1.height/10);
        }, 700*3);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_3 = game.add.sprite(game.world.centerX,game.height/16,'inst_3');
          inst_3.scale.setTo(configuration.scale_ratio);
          inst_3.x -= inst_3.width/2;
          inst_3.y = inst_2.y+inst_2.height+(inst_2.height/10);
        }, 700*4);

        setTimeout(function() {
            a_button8.play();
            startBtn = game.add.button(
                game.world.centerX, game.height * 0.8, "startBtn", startBtnClick, this, 1, 1, 0
            );
            startBtn.scale.setTo(configuration.scale_ratio);
            startBtn.x -= startBtn.width/2;
            startBtn.y = inst_bg.y+inst_bg.height+(startBtn.height/3);
        }, 700*5);

    }

    function muteBtn_onClick() {
      game.sound.mute = false;
        muteBtn_on.visible = false;
        muteBtn_off.visible = true;
    }

    function muteBtn_offClick() {
      game.sound.mute = true;
        muteBtn_off.visible = false;
        muteBtn_on.visible = true;
    }


    function startBtnClick() {
      a_button8.play();
      inst_bg.destroy();
      inst_1.destroy();
      inst_2.destroy();
      inst_3.destroy();
      startBtn.destroy();

        /* start countdown animation */
        popupCount();
    }

    function basketBtnClick() {
        a_button8.play();
        txtScore.destroy();
        if(finalScore >= 100){
          clear.destroy();
          clear_1.destroy();
          clear_2.destroy();
          clear_bg.destroy();
        } else {
          fail.destroy();
          fail_1.destroy();
          fail_bg.destroy();
        }
        basketBtn.destroy();

        basket_board = game.add.sprite(game.world.centerX,gameHeight/20,'basket_board');
        basket_board.scale.setTo(configuration.scale_ratio);
        basket_board.x -= basket_board.width/2;



          basket_1 = game.add.sprite(game.world.centerX,game.height/16,'basket_1');
          basket_1.scale.setTo(configuration.scale_ratio);
          basket_1.x -= basket_1.width/2;
          basket_1.y = basket_board.y+basket_1.height*0.65;

          basket_2 = game.add.sprite(game.world.centerX,game.height/16,'basket_2');
          basket_2.scale.setTo(configuration.scale_ratio);
          basket_2.x -= basket_2.width/2;
          basket_2.y = basket_1.y+basket_1.height+(basket_1.height/11);

          basket_3 = game.add.sprite(game.world.centerX,game.height/16,'basket_3');
          basket_3.scale.setTo(configuration.scale_ratio);
          basket_3.x -= basket_3.width/2;
          basket_3.y = basket_2.y+basket_2.height+(basket_2.height/11);

          basket_4 = game.add.sprite(game.world.centerX,game.height/16,'basket_4');
          basket_4.scale.setTo(configuration.scale_ratio);
          basket_4.x -= basket_4.width/2;
          basket_4.y = basket_3.y+basket_3.height+(basket_3.height/11);

          basket_5 = game.add.sprite(game.world.centerX,game.height/16,'basket_5');
          basket_5.scale.setTo(configuration.scale_ratio);
          basket_5.x -= basket_1.width/2;
          basket_5.y = basket_board.y+basket_1.height*0.65;
          basket_5.visible = false;

          basket_6 = game.add.sprite(game.world.centerX,game.height/16,'basket_6');
          basket_6.scale.setTo(configuration.scale_ratio);
          basket_6.x -= basket_6.width/2;
          basket_6.y = basket_5.y+basket_5.height+(basket_5.height/11);
          basket_6.visible = false;

          basket_7 = game.add.sprite(game.world.centerX,game.height/16,'basket_7');
          basket_7.scale.setTo(configuration.scale_ratio);
          basket_7.x -= basket_7.width/2;
          basket_7.y = basket_6.y+basket_6.height+(basket_6.height/11);
          basket_7.visible = false;

        linkBtn_1 = game.add.button(
            0,0, "linkBtn", linkBtn_onClick1, this, 1, 1, 0
        );
        linkBtn_1.scale.setTo(configuration.scale_ratio);
        linkBtn_1.x = basket_1.x+basket_1.width-(linkBtn_1.width*1.1);
        linkBtn_1.y = basket_1.y+basket_1.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_2 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick2, this, 1, 1, 0
        );
        linkBtn_2.scale.setTo(configuration.scale_ratio);
        linkBtn_2.x = basket_2.x+basket_2.width-(linkBtn_1.width*1.1);
        linkBtn_2.y = basket_2.y+basket_2.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_3 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick3, this, 1, 1, 0
        );
        linkBtn_3.scale.setTo(configuration.scale_ratio);
        linkBtn_3.x = basket_3.x+basket_3.width-(linkBtn_1.width*1.1);
        linkBtn_3.y = basket_3.y+basket_3.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_4 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick4, this, 1, 1, 0
        );
        linkBtn_4.scale.setTo(configuration.scale_ratio);
        linkBtn_4.x = basket_4.x+basket_4.width-(linkBtn_1.width*1.1);
        linkBtn_4.y = basket_4.y+basket_4.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_5 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick5, this, 1, 1, 0
        );
        linkBtn_5.scale.setTo(configuration.scale_ratio);
        linkBtn_5.x = linkBtn_1.x;
        linkBtn_5.y = linkBtn_1.y;
        linkBtn_5.visible=false;

        linkBtn_6 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick6, this, 1, 1, 0
        );
        linkBtn_6.scale.setTo(configuration.scale_ratio);
        linkBtn_6.x = linkBtn_2.x;
        linkBtn_6.y = linkBtn_2.y;
        linkBtn_6.visible=false;


        linkBtn_7 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick7, this, 1, 1, 0
        );
        linkBtn_7.scale.setTo(configuration.scale_ratio);
        linkBtn_7.x = linkBtn_3.x;
        linkBtn_7.y = linkBtn_3.y;
        linkBtn_7.visible=false;

        basket_left = game.add.button(
          game.world.centerX,0, "basket_left", basket2left, this, 1, 1, 0
        );
        basket_left.scale.setTo(configuration.scale_ratio/2);
        basket_left.x -= basket_left.width/2;
        basket_left.x = basket_board.x;
        basket_left.y = basket_board.y+basket_board.height+(basket_left.height/3);
        basket_left.visible=false;

        basket_right = game.add.button(
          game.world.centerX,0, "basket_right", basket2right, this, 1, 1, 0
        );
        basket_right.scale.setTo(configuration.scale_ratio/2);
        // basket_right.x -= basket_left.width/2;
        basket_right.x = basket_board.x+basket_board.width-basket_left.width;
        basket_right.y = basket_board.y+basket_board.height+(basket_left.height/3);

        /**
          최종 스코어 출력 가능
        */
        getFinalScore();

        var millSec = 1000;
        setRestart_5(millSec);


    }

    function basket2left() {
      basket_1.visible = true;
      linkBtn_1.visible = true;
      basket_2.visible = true;
      linkBtn_2.visible = true;
      basket_3.visible = true;
      linkBtn_3.visible = true;
      basket_4.visible = true;
      linkBtn_4.visible = true;
      basket_right.visible = true;

      basket_5.visible = false;
      linkBtn_5.visible = false;
      basket_6.visible = false;
      linkBtn_6.visible = false;
      basket_7.visible = false;
      linkBtn_7.visible = false;
      basket_left.visible = false;
    }

    function basket2right() {
      basket_1.visible = false;
      linkBtn_1.visible = false;
      basket_2.visible = false;
      linkBtn_2.visible = false;
      basket_3.visible = false;
      linkBtn_3.visible = false;
      basket_4.visible = false;
      linkBtn_4.visible = false;
      basket_right.visible = false;

      basket_5.visible = true;
      linkBtn_5.visible = true;
      basket_6.visible = true;
      linkBtn_6.visible = true;
      basket_7.visible = true;
      linkBtn_7.visible = true;
      basket_left.visible = true;
    }

    function linkBtn_onClick1() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%95%84%EB%AA%AC%EB%93%9C&ord=&sprice=&eprice=&cacode=11010000&pdcode=171');
    }
    function linkBtn_onClick2() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%B9%AB%EC%86%94&ord=&sprice=&eprice=&cacode=12040000&pdcode=61262');
    }
    function linkBtn_onClick3() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EA%B5%AD%EA%B0%84%EC%9E%A5&ord=&sprice=&eprice=&cacode=11090000&pdcode=0061648');
    }
    function linkBtn_onClick4() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?cacode=12020000&pdcode=61057');
    }
    function linkBtn_onClick5() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%A3%BC%EB%B0%A9%EC%84%B8%EC%A0%9C&ord=&sprice=&eprice=&cacode=12030000&pdcode=61435');
    }
    function linkBtn_onClick6() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?cacode=12020000&pdcode=61140');
    }
    function linkBtn_onClick7() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/plan/plan_list.do?num=63');
    }


    function restartBtnClick() {
      a_button8.play();
      // var url = window.location.href;
      // var path = window.location.pathname;
      location.reload();
    }

    function count_GO(millisecondsToWait, ratio) {
      a_go.play();
      img_GO = game.add.sprite(game.world.centerX,game.world.height/5,'img_GO');
      img_GO.scale.setTo(configuration.scale_ratio);
      img_GO.position.x -= img_GO.width/2;
      img_GO.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],30,false);
      img_GO.animations.play('start');
        setTimeout(function() {
            // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
            img_GO.destroy();
            gameStart();
        }, millisecondsToWait);
    }

    function count_1(millisecondsToWait, ratio) {
      a_123.play();
        img_1 = game.add.sprite(game.world.centerX,game.world.height/5,'img_1');
        img_1.scale.setTo(configuration.scale_ratio);
        img_1.position.x -= img_1.width/2;
        img_1.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_1.animations.play('start');
        setTimeout(function() {
          img_1.destroy();
          count_GO(millisecondsToWait);
        }, millisecondsToWait);
    }

    function count_2(millisecondsToWait, ratio) {
      a_123.play();
        img_2 = game.add.sprite(game.world.centerX,game.world.height/5,'img_2');
        img_2.scale.setTo(configuration.scale_ratio);
        img_2.position.x -= img_2.width/2;
        img_2.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_2.animations.play('start');
        setTimeout(function() {
          img_2.destroy();
          count_1(millisecondsToWait);
        }, millisecondsToWait);
    }

    function count_3(millisecondsToWait, ratio) {
        a_123.play();
        img_3 = game.add.sprite(game.world.centerX,game.world.height/5,'img_3');
        img_3.scale.setTo(configuration.scale_ratio);
        img_3.position.x -= img_3.width/2;
        img_3.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_3.animations.play('start');
        initGame();
        setTimeout(function() {
            img_3.destroy();
            count_2(millisecondsToWait);
        }, millisecondsToWait);
    }

    function popupCount() {
        var millisecondsToWait = 1000;
        //var ratio=2;

        //count_3(millisecondsToWait,ratio);
        count_3(millisecondsToWait);
    }

    function setRestart_5(millSec) {
      restart_5 = game.add.image(
        game.world.centerX , game.height * 0.8, "restart_5"
      );
      restart_5.scale.setTo(configuration.scale_ratio);
      restart_5.x -= restart_5.width/2;
      restart_5.y = basket_left.y+basket_left.height+(basket_left.height/3);
      setTimeout(function() {
        restart_5.destroy();
        setRestart_4(millSec);
      }, millSec);
    }

    function setRestart_4(millSec) {
      restart_4 = game.add.image(
        game.world.centerX , game.height * 0.8, "restart_4"
      );
      restart_4.scale.setTo(configuration.scale_ratio);
      restart_4.x -= restart_4.width/2;
      restart_4.y = basket_left.y+basket_left.height+(basket_left.height/3);
      setTimeout(function() {
        restart_4.destroy();
        setRestart_3(millSec);
      }, millSec);
    }

    function setRestart_3(millSec) {
      restart_3 = game.add.image(
        game.world.centerX , game.height * 0.8, "restart_3"
      );
      restart_3.scale.setTo(configuration.scale_ratio);
      restart_3.x -= restart_3.width/2;
      restart_3.y = basket_left.y+basket_left.height+(basket_left.height/3);
      setTimeout(function() {
        restart_3.destroy();
        setRestart_2(millSec);
      }, millSec);
    }

    function setRestart_2(millSec) {
      restart_2 = game.add.image(
        game.world.centerX , game.height * 0.8, "restart_2"
      );
      restart_2.scale.setTo(configuration.scale_ratio);
      restart_2.x -= restart_2.width/2;
      restart_2.y = basket_left.y+basket_left.height+(basket_left.height/3);
      setTimeout(function() {
        restart_2.destroy();
        setRestart_1(millSec);
      }, millSec);
    }

    function setRestart_1(millSec) {
      restart_1 = game.add.image(
        game.world.centerX , game.height * 0.8, "restart_1"
      );
      restart_1.scale.setTo(configuration.scale_ratio);
      restart_1.x -= restart_1.width/2;
      restart_1.y = basket_left.y+basket_left.height+(basket_left.height/3);
      setTimeout(function() {
        restart_1.destroy();
        setRestart(millSec);
      }, millSec);
    }

    function setRestart(millSec) {
      restart = game.add.button(
        game.world.centerX , game.height * 0.8, "restart",restartBtnClick
      );
      restart.scale.setTo(configuration.scale_ratio);
      restart.x -= restart.width/2;
      restart.y = basket_left.y+basket_left.height+(basket_left.height/3);
    }

    function initGame() {
      for (var i = 0; i < game.width / 10; i++) {
          var rowBox = box.create(i * 10, 80, "box");
          rowBox.body.immovable = true; // box가 움직이지 못하도록 설정
          rowBox = box.create(i * 10, game.height - 10, "box");
          rowBox.body.immovable = true; // box가 움직이지 못하도록 설정
      }
      for (var j = 9; j < game.height / 10; j++) {
          var colBox = box.create(0, j * 10, "box");
          colBox.body.immovable = true; // box가 움직이지 못하도록 설정
          colBox = box.create(game.width - 10, j * 10, "box");
          colBox.body.immovable = true; // box가 움직이지 못하도록 설정
      }

      /* 플레이어 추가 */
      player = game.add.sprite(game.world.centerX,game.world.centerY, "player");
      player.scale.setTo(configuration.scale_ratio);
      game.physics.arcade.enable(player);
      // 평상시 뛰는 애니메이션
      player.animations.add("run", [0, 1, 2, 3, 4, 5, 6, 7], 10, true);
      // 긍정적 아이템 습득시 애니메이션
      player.animations.add("good", [9], 10, false);
      // 부정적 아이템 습득시 애니메이션
      player.animations.add("bad", [8], 10, false);
      // img_3 = game.add.sprite(game.world.centerX,game.world.height/5,'img_3');
      // img_3.scale.setTo(configuration.scale_ratio);
      // img_3.position.x -= img_3.width/2;
      // img_3.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
      // img_3.animations.play('start');
    }

    function gameStart() {
      a_game_bgm.play();


        enemy.enableBody = true;
        enemy.physicsBodyType = Phaser.Physics.ARCADE;

        txtScore.visible = true;

        // start the timer
        timer.start();

        /* 아이템 미리 로드 */
        var pre_lv1 = [];
        var lv1 = [];

        var pre_lv2 = [];
        var lv2 = [];

        var pre_lv2 = [];
        var lv2 = [];

        var pre_lv3 = [];
        var lv3 = [];

        var pre_lv4 = [];
        var lv4 = [];

        var pre_lv5 = [];
        var lv5 = [];

        var pre_lv6 = [];
        var lv6 = [];

        /*
          60~50;
        */

        //1
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;

            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            console.log(x);
            var item = enemy.create(x, 80, "item_1");
            item.scale.set(configuration.scale_ratio/2);
            item.visible = false;
            item['score']=1;
            pre_lv1.push(item);
        }
        //2
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        //3
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        ///4
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        //5
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        //6
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        //7
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv1.push(item);
        }
        //trash
        for (var i = 0; i < 3; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv1.push(item);
        }
        //지담터
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv1.push(item);
        }

        /*
          50~40;
        */

        //1
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_1");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //2
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //3
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        ///4
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //5
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //6
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //7
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv2.push(item);
        }
        //trash
        for (var i = 0; i < 3; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv2.push(item);
        }
        //지담터
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv2.push(item);
        }

        /*
          40~30;
        */

        //1
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_1");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //2
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //3
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        ///4
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //5
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //6
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //7
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv3.push(item);
        }
        //trash
        for (var i = 0; i < 4; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv3.push(item);
        }
        //지담터
        for (var i = 0; i < 3; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv3.push(item);
        }

        /*
          30~20;
        */

        //1
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_1");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //2
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //3
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        ///4
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //5
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //6
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //7
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv4.push(item);
        }
        //trash
        for (var i = 0; i < 6; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv4.push(item);
        }
        //지담터
        for (var i = 0; i < 4; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv4.push(item);
        }

        /*
          20~10;
        */

        //1
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_1");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //2
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //3
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        ///4
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //5
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //6
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //7
        for (var i = 0; i < 1; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv5.push(item);
        }
        //trash
        for (var i = 0; i < 7; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv5.push(item);
        }
        //지담터
        for (var i = 0; i < 5; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv5.push(item);
        }

        /*
          10~0;
        */

        //1
        for (var i = 0; i < 3; i++) {
            var cache = (game.cache.getImage("item_1").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_1");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //2
        for (var i = 0; i < 3; i++) {
            var cache = (game.cache.getImage("item_2").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_2");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //3
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_3").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_3");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        ///4
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_4").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_4");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //5
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_5").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_5");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //6
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_6").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_6");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //7
        for (var i = 0; i < 2; i++) {
            var cache = (game.cache.getImage("item_7").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "item_7");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']=1;
            pre_lv6.push(item);
        }
        //trash
        for (var i = 0; i < 8; i++) {
            var cache = (game.cache.getImage("trash").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "trash");
            item.visible = false;
            item.scale.set(configuration.scale_ratio/2);
            item['score']= -1;
            pre_lv6.push(item);
        }
        //지담터
        for (var i = 0; i < 6; i++) {
            var cache = (game.cache.getImage("jadamteo").width)*configuration.scale_ratio;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item.scale.set(configuration.scale_ratio*2);
            item['score']=5;
            pre_lv6.push(item);
        }

        //enemy.scale.set(configuration.scale_ratio);
        enemy.setAll("outOfBoundsKill", true);
        enemy.setAll("checkWorldBounds", true);
        /*
          SHUFFLE ITEM ARRAY
        */
        lv1 = shuffleArray(pre_lv1);
        lv2 = shuffleArray(pre_lv2);
        lv3 = shuffleArray(pre_lv3);
        lv4 = shuffleArray(pre_lv4);
        lv5 = shuffleArray(pre_lv5);
        lv6 = shuffleArray(pre_lv6);

        var speed = (150+30*6)*2;
        if(!isMobile) {
          speed = speed*0.3;
        }


        var i = 0;
        /* 아이템 낙하 */
        level1 = setInterval(
            function() {
              if (i == lv1.length) {
                i=0;
                destroy(level1);
                level2 = setInterval(
                    function() {
                      if (i == lv2.length) {
                        i=0;
                        destroy(level2);
                        level3 = setInterval(
                            function() {
                              if (i == lv3.length) {
                                i=0;
                                destroy(level3);
                                level4 = setInterval(
                                    function() {
                                      if (i == lv4.length) {
                                        i=0;
                                        destroy(level4);
                                        level5 = setInterval(
                                            function() {
                                              if (i == lv5.length) {
                                                i=0;
                                                destroy(level5);
                                                level6 = setInterval(
                                                    function() {
                                                      if (i == lv6.length) {
                                                        i=0;
                                                        destroy(level6);
                                                      } else {
                                                        var item = lv6[i];
                                                        item.visible = true;
                                                        game.physics.arcade.moveToXY(item, item.x, game.height, speed*2.0);
                                                        i++;
                                                      }
                                                    }, 1000*10/lv6.length
                                                );
                                              } else {
                                                var item = lv5[i];
                                                item.visible = true;
                                                game.physics.arcade.moveToXY(item, item.x, game.height, speed*1.8);
                                                i++;
                                              }
                                            }, 1000*10/lv5.length
                                        );
                                      } else {
                                        var item = lv4[i];
                                        item.visible = true;
                                        game.physics.arcade.moveToXY(item, item.x, game.height, speed*1.6);
                                        i++;
                                      }
                                    }, 1000*10/lv4.length
                                );
                              } else {
                                var item = lv3[i];
                                item.visible = true;
                                game.physics.arcade.moveToXY(item, item.x, game.height, speed*1.4);
                                i++;
                              }
                            }, 1000*10/lv3.length
                        );
                      } else {
                        var item = lv2[i];
                        item.visible = true;
                        game.physics.arcade.moveToXY(item, item.x, game.height, speed*1.2);
                        i++;
                      }
                    }, 1000*10/lv2.length
                );
              } else {
                var item = lv1[i];
                item.visible = true;
                game.physics.arcade.moveToXY(item, item.x, game.height, speed);
                i++;
              }
            }, 1000*10/lv1.length
        );













    }
    /**
     * Randomize array element order in-place.
     * Using Durstenfeld shuffle algorithm.
     */
    function shuffleArray(array) {
        for (var i = array.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var temp = array[i];
            array[i] = array[j];
            array[j] = temp;
        }
        return array;
    }

    /**
     * Returns a random integer between min (inclusive) and max (inclusive)
     * Using Math.round() will give you a non-uniform distribution!
     */
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function destroy(i) {
      clearInterval(i);
    }
</script>

</html>
