<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pulmuone</title>
    <style media="screen">
      body { margin:0px; padding:0px; }
    </style>
</head>
<body>
</body>
<script type="text/javascript" src="./js/phaser.min.js"></script>
<script type="text/javascript">
var gameWidth = 360;
var gameHeight = 640;
var scaleRatio;
var isMobile = (/iphone|ipod|android|ie|blackberry|fennec/).test(navigator.userAgent.toLowerCase());
if(isMobile) {
  gameWidth = window.innerWidth;
  gameHeight = window.innerHeight;
  //alert(gameHeight);
}
    var game = new Phaser.Game(gameWidth, gameHeight, Phaser.CANVAS,  'game', {
        preload: preload,
        create: create,
        update: update,
        render: render,
    });
    if (isMobile) {
      this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.scale.minWidth = gameWidth / 2;
      this.scale.minHeight = gameHeight / 2;
      this.scale.maxWidth = gameWidth;
      this.scale.maxHeight = gameHeight;
      this.scale.pageAlignHorizontally = true;
      this.scale.pageAlignVertically = true;
      this.scale.setScreenSize(true);
    } else {
      this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.scale.minWidth = gameWidth / 2;
      this.scale.minHeight = gameHeight / 2;
      this.scale.maxWidth = 2048; //You can change this to gameWidth*2.5 if needed
      this.scale.maxHeight = 1228; //Make sure these values are proportional to the gameWidth and gameHeight
      this.scale.pageAlignHorizontally = true;
      this.scale.pageAlignVertically = true;
      this.scale.forceOrientation(true, false);
      this.scale.hasResized.add(this.gameResized, this);
      this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation, this);
      this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation, this);
      this.scale.setScreenSize(true);
    }

    var start; // 로고 화면
    var logo;// 시작 화면 logo sprite
    var title_sprite; // 시작 화면 캐릭터 sprite
    var firstBg; //로고 화면 버튼 기능을 할 투명한 배경
    var firstBtn; // touch to start image
    var muteBtn_on; // 음소거 버튼(활성화)
    var muteBtn_off; // 음소거 버튼(비활성화)
    var inst_bg; //게임 시작 전 화면 배경
    var inst_1; //게임 시작 전 화면 배경
    var inst_2; //게임 시작 전 화면 배경
    var inst_3; //게임 시작 전 화면 배경
    var startBtn; //시작버튼
    var bg; // 게임 배경 이미지
    var box; // 그룹 형성용 이미지
    var player // 플레이어
    var enemy; // 회피물
    var enemyAlive; // 회피물 존재 여부
    var enemyArray = []; // 생성될 회피물의 정보
    var life = 1; // 플레이어 생명
    var timer; // 타이머
    var timerEvent; // 타이머 이벤트
    var score = 0; // 점수
    var txtScore;
    var eventScore;
    var img_1; //1
    var img_2; //2
    var img_3; //3
    var img_GO; //GO!
    var isHit = false; //충돌 유무 확인
    var player_y_record = -1; //최초 플레이어 y지점 기록
    var clear; //성공 애니메이션
    var clear_1; //성공 캐릭터 1
    var clear_2; //성공 캐릭터 2
    var clear_bg; //성공 빵빠레
    var fail; // 실패 애니메이션
    var fail_1; // 실패 캐릭터 1
    var fail_bg; // 실패 배경
    var basketBtn; // 장바구니 확인 버튼
    var basket_board; // 장바구니 배경 이미지
    var basket_1; // 장바구니 아이템 1
    var basket_2; // 장바구니 아이템 2
    var basket_3; // 장바구니 아이템 3
    var basket_4; // 장바구니 아이템 4
    var basket_5; // 장바구니 아이템 5
    var basket_6; // 장바구니 아이템 6
    var basket_7; // 장바구니 아이템 7
    var resultBtn; // 결과창 이동 버튼
    var hard = false;
    var easyMode;
    var hardMode;
    var finalScore;//최종점수
    var final_text_1;
    var final_text_2;
    var restartBtn;
    var good = true;
    var a_123;
    var a_button8;
    var a_fail;
    var a_game_bgm;
    var a_go;
    var a_object;
    var a_start;
    var a_success;
    var linkBtn_1;
    var linkBtn_2;
    var linkBtn_3;
    var scaleRatio;
    var firstBtnBlink;
    var group_muteBtn;// mute on/off button always one top;
    var page = 1; // 장바구니 페이지 변수

    /* -----PRELOAD----- */
    function preload() {
        //게임에 필요한 데이터 로드
        /* 게임 시작전 화면 이미지 로드 */
        game.load.spritesheet("logo", "./images/logo.png", 553, 269);
        game.load.spritesheet("title_sprite", "./images/title_sprite.png", 720, 650);
        game.load.image("firstBg", "./images/firstBg.png");
        game.load.image("firstBtn", "./images/firstBtn.png");
        game.load.image("muteBtn_on", "./images/muteBtn_on.png");
        game.load.image("muteBtn_off", "./images/muteBtn_off.png");
        game.load.image("inst_bg", "./images/inst_bg.png");
        game.load.image("inst_1", "./images/inst_1.png");
        game.load.image("inst_2", "./images/inst_2.png");
        game.load.image("inst_3", "./images/inst_3.png");
        game.load.image("startBtn", "./images/startBtn.png");
        /* 배경 이미지 로드 */
        game.load.image("background", "./images/background.png");
        /* 그룹 형성 시에 사용할 박스 이미지 로드 */
        game.load.image("box", "./images/box.png");
        /* 플레이어를 기본 32x40 크기로 설정. 'player' 이름으로 생성 */
        game.load.spritesheet("player", "./images/player.png", 256, 256);
        /* 카운트다운 이미지 로드 */
        game.load.spritesheet("img_1", "./images/count/img_1.png",228,228);
        game.load.spritesheet("img_2", "./images/count/img_2.png",228,228);
        game.load.spritesheet("img_3", "./images/count/img_3.png",228,228);
        game.load.spritesheet("img_GO", "./images/count/img_GO.png",228,228);
        /* 아이템 로드 */
        game.load.image("g_obj_01", "./images/items/g_obj_01.png");
        game.load.image("g_obj_02", "./images/items/g_obj_02.png");
        game.load.image("g_obj_03", "./images/items/g_obj_03.png");
        game.load.image("g_obj_04", "./images/items/g_obj_04.png");
        game.load.image("g_obj_05", "./images/items/g_obj_05.png");
        game.load.image("g_obj_06", "./images/items/g_obj_06.png");
        game.load.image("g_obj_07", "./images/items/g_obj_07.png");
        game.load.image("g_obj_08", "./images/items/g_obj_08.png");
        game.load.image("jadamteo", "./images/items/jadamteo.png");

        /* 게임오버 이미지 로드 */
        game.load.spritesheet("clear", "./images/clear.png",560,390);
        game.load.image("clear_1", "./images/clear_1.png");
        game.load.image("clear_2", "./images/clear_2.png");
        game.load.image("clear_bg", "./images/clear_bg.png");
        game.load.spritesheet("fail", "./images/fail.png",317,194);
        game.load.image("fail_1", "./images/fail_1.png");
        game.load.image("fail_bg", "./images/fail_bg.png");

        /* 바구니 확인 버튼 로드 */
        game.load.image("basketBtn", "./images/basketBtn.png");
        /* 바구니 확인 board 로드 */
        game.load.image("basket_board", "./images/basket_board.png");
        /* 장바구니 아이템 로드 */
        game.load.image("basket_1", "./images/basket/basket_1.png");
        game.load.image("basket_2", "./images/basket/basket_2.png");
        game.load.image("basket_3", "./images/basket/basket_3.png");
        game.load.image("basket_4", "./images/basket/basket_4.png");
        game.load.image("basket_5", "./images/basket/basket_5.png");
        game.load.image("basket_6", "./images/basket/basket_6.png");
        game.load.image("basket_7", "./images/basket/basket_7.png");
        /* 제품보러가기 버튼 로드 */
        game.load.image("linkBtn", "./images/linkBtn.png");

        /* 결과창 이동 버튼 로드 */
        game.load.spritesheet("resultBtn", "./images/resultBtn.png",336,127);
        /* 재시작 버튼 추가 */
        game.load.image("restartBtn", "./images/restartBtn.png");

        /* 효과음 로드*/
        game.load.audio('123', './audio/123.mp3');
        game.load.audio('button8', './audio/button8.wav');
        game.load.audio('fail', './audio/fail.mp3');
        game.load.audio('game_bgm', './audio/game_bgm.mp3');
        game.load.audio('go', './audio/go.mp3');
        game.load.audio('object', './audio/object.mp3');
        game.load.audio('start', './audio/start.mp3');
        game.load.audio('success', './audio/success.mp3');
    }




    /* -----CREATE----- */
    function create() {

        /* 게임 처음 실행 시 수행되는 함수 */
        game.physics.startSystem(Phaser.Physics.ARCADE);
        if(isMobile) {
          scaleRatio = (gameWidth/gameHeight)*window.devicePixelRatio;
        } else {
          scaleRatio = 0.5;
        }

        /* 음악설정 */
        a_123 = game.add.audio('123');
        a_button8 = game.add.audio('button8');
        a_fail = game.add.audio('fail');
        a_game_bgm = game.add.audio('game_bgm');
        a_go = game.add.audio('go');
        a_object = game.add.audio('object');
        a_start = game.add.audio('start');
        a_success = game.add.audio('success');
        /* 배경화면 설정 */
        bg = game.add.sprite(0, 0, "background");
        a_start.play();

        //비율 설정
        if(isMobile){
          bg.width = gameWidth;
          bg.height = gameHeight;
        } else {
          bg.scale.setTo(scaleRatio,scaleRatio);
        }

        logo = game.add.sprite(game.world.centerX,game.world.height/8,'logo');
        logo.scale.setTo(scaleRatio,scaleRatio);

        logo.position.x -= logo.width/2;
        logo.animations.add('start',[0,1,2,3,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19],10,false);
        logo.animations.play('start');

        title_sprite = game.add.sprite(game.world.centerX,game.world.height*0.6,'title_sprite');
        title_sprite.scale.setTo(scaleRatio/1.5,scaleRatio/1.5);
        title_sprite.position.x -= title_sprite.width/2;
        title_sprite.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],30,true);
        title_sprite.animations.play('start');

        setTimeout(function() {
          firstBg = game.add.button(0, 0, "firstBg", firstBtnClick, this, 1, 1, 0
          );
          firstBtn = game.add.sprite(game.world.centerX,game.height*0.93,'firstBtn');
          firstBtn.scale.setTo(scaleRatio,scaleRatio);
          firstBtn.x -= firstBtn.width/2;
          if(isMobile){
            firstBg.width = gameWidth;
            firstBg.height = gameHeight;
          } else {
            firstBg.scale.setTo(scaleRatio,scaleRatio);
          }
        }, 2200);

        firstBtnBlink = setInterval(
            function() {
              if(firstBtn != undefined) {
                var i = 0;
                if(firstBtn.visible) {
                  firstBtn.visible = false;
                } else {
                  firstBtn.visible = true;
                }
              }
              if(group_muteBtn != undefined)
                game.world.bringToTop(group_muteBtn);
            }, 600
        );


        /* 음소거 버튼 설정 */
        muteBtn_on = game.add.button(
            game.width
            , 10
            , "muteBtn_on", muteBtn_onClick, this, 1, 1, 0
        );
        muteBtn_on.scale.setTo(scaleRatio, scaleRatio);
        muteBtn_on.x -= (muteBtn_on.width)+10
        muteBtn_on.visible = false;

        muteBtn_off = game.add.button(
            game.width
            , 10
            , "muteBtn_off", muteBtn_offClick, this, 1, 1, 0
        );
        muteBtn_off.scale.setTo(scaleRatio, scaleRatio);
        muteBtn_off.x -= (muteBtn_off.width)+10

        group_muteBtn = game.add.group();
        group_muteBtn.add(muteBtn_on);
        group_muteBtn.add(muteBtn_off);
        game.world.bringToTop(group_muteBtn);

        // create a custom time
        timer = game.time.create();

        // create a delayed event 1m and 30s from now
        // timerEvent = timer.add(Phaser.Timer.MINUTE * 2, endTimer, this);
        timerEvent = timer.add(Phaser.Timer.SECOND * 1, endTimer, this);


        /* box 그룹 생성 */
        box = game.add.group();
        box.enableBody = true; // box에 출돌속성을 설정.

        /* 회피물 생성 */
        enemy = game.add.group();


        /* Game Over */


        /* Score */
        txtScore= game.add.text(10, 10, 'Score: 0', { font: '16pt Arial', fill: '#ffffff' });
        txtScore.position.x = game.world.centerX-(txtScore.width/2)
        txtScore.visible = false;
    }



    /* -----UPDATE----- */
    function update() {
        /*  프레임워크에서 주기적으로 수행하는 함수 */
        if (life < 1) {
          player.visible=false;
          enemy.visible=false;
          txtScore.visible=false;
          return;
        }
        /* box 밖으로의 움직임 제한 */
        game.physics.arcade.collide(player, box);

        game.physics.arcade.overlap(player, enemy, enemyHitsPlayer, null, this);

        /* 플레이어 움직임 정의 */
        if (player != undefined) {
            player.body.velocity.setTo(0, 0); // 관성을 0으로 설정

            //  400 is the speed it will move towards the mouse
            //game.physics.arcade.moveToPointer(player, 400);
            game.physics.arcade.moveToXY(player, game.input.x, game.height, 1000);
            if (isHit) {
              if(good) {
                player.animations.play("good");
              } else {
                player.animations.play("bad");
              }
            } else if (game.input.mousePointer.x > player.x || game.input.mousePointer.x < player.x) {
                player.animations.play("run");
            } else {
                //player.animations.stop();
                // player.frame = 3;
            }
        }




        // if (enemy != undefined) {
        if (false) {
            /* 회피물 세팅 */
            enemyAlive = enemy.getFirstExists(false);
            enemyArray.length = 0;
            // box 개수 만큼 회피물을 세팅
            box.forEachAlive(function(enemyAlive) {
                enemyArray.push(enemyAlive);
            });
            // box 중 랜덤으로 하나를 골라서 회피물 생성
            if (enemyAlive && enemyArray.length > 0) {
                var random = game.rnd.integerInRange(0, enemyAlive.length - 1);
                var enemyBox = enemyArray[random];
                enemyAlive.reset(game.rnd.integerInRange(0, game.width), 80);
                game.physics.arcade.moveToXY(enemyAlive, enemyAlive.x, game.height, 150);
            }
        }
    }
    function endTimer() {
        // Stop the timer when the delayed event triggers
        timer.stop();
        a_game_bgm.stop();
        finalScore = score;
        life = 0;
        if(finalScore >= 100){
        // if(false){
          a_success.play();
          clear_bg = game.add.sprite(0, 0,'clear_bg');
          clear_bg.width = gameWidth;
          clear_bg.height = gameHeight;
          clear = game.add.sprite(game.world.centerX,game.world.height/5,'clear');
          clear.scale.setTo(scaleRatio,scaleRatio);
          clear.position.x -= clear.width/2;
          clear.position.y -= clear.height/2;
          clear.animations.add('start',[0,1,2,3,4,5],20,false);
          clear.animations.play('start');
          clear_1 = game.add.sprite(game.world.centerX, game.world.centerY,'clear_1');
          clear_1.scale.setTo(scaleRatio,scaleRatio);
          clear_1.position.x -= clear_1.width/2;
          clear_1.position.y -= clear_1.height/2;
          setTimeout(
            function() {
              clear_1.destroy();
              clear_2 = game.add.sprite(game.world.centerX, game.world.centerY,'clear_2');
              clear_2.scale.setTo(scaleRatio,scaleRatio);
              clear_2.position.x -= clear_2.width/2;
              clear_2.position.y -= clear_2.height/2;
            }, 1000
          );
        } else {
          a_fail.play();
          fail_bg = game.add.sprite(0, 0,'fail_bg');
          fail_bg.width = gameWidth;
          fail_bg.height = gameHeight;
          fail =  game.add.sprite(game.world.centerX,game.world.height/5,'fail');
          fail.scale.setTo(scaleRatio,scaleRatio);
          fail.position.x -= fail.width/2;
          fail.position.y -= fail.height/2;
          fail.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10],20,false);
          fail.animations.play('start');
          fail_1 = game.add.sprite(game.world.centerX, game.world.centerY,'fail_1');
          fail_1.scale.setTo(scaleRatio*1.5,scaleRatio*1.5);
          fail_1.position.x -= fail_1.width/2;
          fail_1.position.y -= fail_1.height/2;
        }

        setTimeout(
            function() {
                basketBtn = game.add.button(
                    game.world.centerX , game.height * 0.8, "basketBtn", basketBtnClick, this, 1, 1, 0
                );
                basketBtn.scale.setTo(scaleRatio, scaleRatio);
                basketBtn.position.x -= basketBtn.width/2;
            }, 1500);
    };

    /* -----RENDER----- */
    function render() {
        if (timer.running) {
            // If our timer is running, show the time in a nicely formatted way,fontSize:"70px Arial",fill: "#FFFFFF"}
            game.debug.text(formatTime(Math.round((timerEvent.delay - timer.ms) / 1000)), game.width-70, 25, "#ffffff");
        } else {
            // else show 'Done'!;

        }
    }


    /* -----FORMATTIMER----- */
    function formatTime(s) {
        //convert seconds (s) to a nicely formatted and padded time string
        var minutes = "0" + Math.floor(s / 60);
        var seconds = "0" + (s - minutes * 60);
        return minutes.substr(-2) + ":" + seconds.substr(-2);
    }


    function enemyHitsPlayer(playerPoint, enemy) {
      a_object.play();
      //console.log(enemy['score']);
        if (player_y_record == -1) {
            player_y_record = player.y;
        }
        enemy.kill();
        isHit = true;
        if(enemy['score']>0) {
          good=true;
        } else {
          good=false;
        }
        //20 만큼 점프
        player.y = player_y_record - 10;
        //life = 0;
        score+=enemy['score'];
        txtScore.setText("Score: " + score);
        setTimeout(function() {
            isHit = false;
        }, 500);
    }

    function firstBtnClick() {
        destroy(firstBtnBlink);
        a_start.stop();
        a_button8.play();
        logo.destroy();
        title_sprite.destroy();
        firstBtn.destroy();
        firstBg.destroy();
        muteBtn_on.destroy();
        muteBtn_off.destroy();

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          inst_bg = game.add.sprite(game.world.centerX,gameHeight/16,'inst_bg');
          inst_bg.scale.setTo(scaleRatio, scaleRatio);
          inst_bg.x -= inst_bg.width/2;
        }, 1000);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_1 = game.add.sprite(game.world.centerX,game.height/16,'inst_1');
          inst_1.scale.setTo(scaleRatio, scaleRatio);
          inst_1.x -= inst_1.width/2;
          inst_1.y = inst_bg.y+(inst_bg.height/3.5);
        }, 1000*2);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_2 = game.add.sprite(game.world.centerX,game.height/16,'inst_2');
          inst_2.scale.setTo(scaleRatio, scaleRatio);
          inst_2.x -= inst_2.width/2;
          inst_2.y = inst_1.y+inst_1.height+(inst_1.height/10);
        }, 1000*3);

        /* 게임 시작 전 화면 설정 */
        setTimeout(function() {
          a_button8.play();
          inst_3 = game.add.sprite(game.world.centerX,game.height/16,'inst_3');
          inst_3.scale.setTo(scaleRatio, scaleRatio);
          inst_3.x -= inst_3.width/2;
          inst_3.y = inst_2.y+inst_2.height+(inst_2.height/10);
        }, 1000*4);




        setTimeout(function() {
            a_button8.play();
            startBtn = game.add.button(
                game.world.centerX, game.height * 0.8, "startBtn", startBtnClick, this, 1, 1, 0
            );
            startBtn.scale.setTo(scaleRatio, scaleRatio);
            startBtn.x -= startBtn.width/2;
        }, 1000*5);

    }

    function muteBtn_onClick() {
      game.sound.mute = false;
        muteBtn_on.visible = false;
        muteBtn_off.visible = true;
    }

    function muteBtn_offClick() {
      game.sound.mute = true;
        muteBtn_off.visible = false;
        muteBtn_on.visible = true;
    }


    function startBtnClick() {
      a_button8.play();
      inst_bg.destroy();
      inst_1.destroy();
      inst_2.destroy();
      inst_3.destroy();
      startBtn.destroy();

        /* start countdown animation */
        popupCount();
    }

    function basketBtnClick() {
        a_button8.play();
        txtScore.destroy();
        if(finalScore >= 100){
          clear.destroy();
          clear_1.destroy();
          clear_2.destroy();
          clear_bg.destroy();
        } else {
          fail.destroy();
          fail_1.destroy();
          fail_bg.destroy();
        }
        basketBtn.destroy();

        basket_board = game.add.sprite(game.world.centerX,gameHeight/16,'basket_board');
        basket_board.scale.setTo(scaleRatio, scaleRatio);
        basket_board.x -= basket_board.width/2;

          basket_1 = game.add.sprite(game.world.centerX,game.height/16,'basket_1');
          basket_1.scale.setTo(scaleRatio, scaleRatio);
          basket_1.x -= basket_1.width/2;
          basket_1.y = basket_board.y+basket_1.height*0.65;

          basket_2 = game.add.sprite(game.world.centerX,game.height/16,'basket_2');
          basket_2.scale.setTo(scaleRatio, scaleRatio);
          basket_2.x -= basket_2.width/2;
          basket_2.y = basket_1.y+basket_1.height+(basket_1.height/11);

          basket_3 = game.add.sprite(game.world.centerX,game.height/16,'basket_3');
          basket_3.scale.setTo(scaleRatio, scaleRatio);
          basket_3.x -= basket_3.width/2;
          basket_3.y = basket_2.y+basket_2.height+(basket_2.height/11);

          basket_4 = game.add.sprite(game.world.centerX,game.height/16,'basket_4');
          basket_4.scale.setTo(scaleRatio, scaleRatio);
          basket_4.x -= basket_4.width/2;
          basket_4.y = basket_3.y+basket_3.height+(basket_3.height/11);

          basket_5 = game.add.sprite(game.world.centerX,game.height/16,'basket_5');
          basket_5.scale.setTo(scaleRatio, scaleRatio);
          basket_5.x -= basket_1.width/2;
          basket_5.y = basket_board.y+basket_1.height*0.65;
          basket_5.visible = false;

          basket_6 = game.add.sprite(game.world.centerX,game.height/16,'basket_6');
          basket_6.scale.setTo(scaleRatio, scaleRatio);
          basket_6.x -= basket_6.width/2;
          basket_6.y = basket_5.y+basket_5.height+(basket_5.height/11);
          basket_6.visible = false;

          basket_7 = game.add.sprite(game.world.centerX,game.height/16,'basket_7');
          basket_7.scale.setTo(scaleRatio, scaleRatio);
          basket_7.x -= basket_7.width/2;
          basket_7.y = basket_6.y+basket_6.height+(basket_6.height/11);
          basket_7.visible = false;

        linkBtn_1 = game.add.button(
            0,0, "linkBtn", linkBtn_onClick1, this, 1, 1, 0
        );
        linkBtn_1.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_1.x = basket_1.x+basket_1.width-(linkBtn_1.width*1.1);
        linkBtn_1.y = basket_1.y+basket_1.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_2 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick2, this, 1, 1, 0
        );
        linkBtn_2.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_2.x = basket_2.x+basket_2.width-(linkBtn_1.width*1.1);
        linkBtn_2.y = basket_2.y+basket_2.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_3 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick3, this, 1, 1, 0
        );
        linkBtn_3.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_3.x = basket_3.x+basket_3.width-(linkBtn_1.width*1.1);
        linkBtn_3.y = basket_3.y+basket_3.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_4 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick4, this, 1, 1, 0
        );
        linkBtn_4.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_4.x = basket_4.x+basket_4.width-(linkBtn_1.width*1.1);
        linkBtn_4.y = basket_4.y+basket_4.height-(linkBtn_1.height+linkBtn_1.width*0.1);

        linkBtn_5 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick5, this, 1, 1, 0
        );
        linkBtn_5.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_5.x = linkBtn_1.x;
        linkBtn_5.y = linkBtn_1.y;
        linkBtn_5.visible=false;

        linkBtn_6 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick6, this, 1, 1, 0
        );
        linkBtn_6.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_6.x = linkBtn_2.x;
        linkBtn_6.y = linkBtn_2.y;
        linkBtn_6.visible=false;


        linkBtn_7 = game.add.button(
          0,0, "linkBtn", linkBtn_onClick7, this, 1, 1, 0
        );
        linkBtn_7.scale.setTo(scaleRatio,scaleRatio);
        linkBtn_7.x = linkBtn_3.x;
        linkBtn_7.y = linkBtn_3.y;
        linkBtn_7.visible=false;

        // resultBtn = game.add.button(
        //       game.world.centerX , game.height * 0.8, "resultBtn", resultBtnClick, this, 4, 4, 0
        //   );
        // //resultBtn.inputEnabled = false;
        // resultBtn.scale.setTo(scaleRatio,scaleRatio);
        // resultBtn.x -= resultBtn.width/2;
        // setTimeout(function() {
        //     // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
        //     resultBtn.setFrames(3);
        // }, 300*1);
        // setTimeout(function() {
        //     // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
        //     resultBtn.setFrames(2);
        // }, 310*2);
        // setTimeout(function() {
        //     // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
        //     resultBtn.setFrames(1);
        // }, 320*3);
        // setTimeout(function() {
        //     // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
        //     resultBtn.setFrames(0);
        // }, 330*4);
        // setTimeout(function() {
        //     // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
        //     resultBtn.setFrames(5);
        // }, 340*5);


    }
    function linkBtn_onClick1() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%95%84%EB%AA%AC%EB%93%9C&ord=&sprice=&eprice=&cacode=11010000&pdcode=171');
    }
    function linkBtn_onClick2() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%B9%AB%EC%86%94&ord=&sprice=&eprice=&cacode=12040000&pdcode=61262');
    }
    function linkBtn_onClick3() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EA%B5%AD%EA%B0%84%EC%9E%A5&ord=&sprice=&eprice=&cacode=11090000&pdcode=0061648');
    }
    function linkBtn_onClick4() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?cacode=12020000&pdcode=61057');
    }
    function linkBtn_onClick5() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?brcode=&sw=%EC%A3%BC%EB%B0%A9%EC%84%B8%EC%A0%9C&ord=&sprice=&eprice=&cacode=12030000&pdcode=61435');
    }
    function linkBtn_onClick6() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/product/prd_view.do?cacode=12020000&pdcode=61140');
    }
    function linkBtn_onClick7() {
      window.open('https://www.pulmuone-lohas.com/pc/shop/plan/plan_list.do?num=63');
    }

    function resultBtnClick() {
      a_button8.play();
      basket_board.visible=false;
      resultBtn.visible=false;
      linkBtn_1.visible=false;
      linkBtn_2.visible=false;
      linkBtn_3.visible=false;
      linkBtn_4.visible=false;
      final_text_1= game.add.text(game.world.centerX, game.height/4, '최종점수', { font: '18pt Arial', fill: '#ffffff' });
      final_text_1.position.x = final_text_1.position.x-(final_text_1.width/2);

      final_text_2= game.add.text(game.world.centerX, game.height/4+50, finalScore, { font: '64pt Arial', fill: '#ffffff' });
      final_text_2.position.x = final_text_2.position.x-(final_text_2.width/2);


      restartBtn = game.add.button(
          (game.cache.getImage("background").width - game.cache.getImage("restartBtn").width) / 4, game.height * 0.8, "restartBtn", restartBtnClick, this, 1, 1, 0
      );
      restartBtn.scale.setTo(0.5, 0.5);
    }

    function restartBtnClick() {
      a_button8.play();
      this.game.state.restart();
    }

    function count_GO(millisecondsToWait, ratio) {
      a_go.play();
      img_GO = game.add.sprite(game.world.centerX,game.world.height/5,'img_GO');
      img_GO.scale.setTo(scaleRatio,scaleRatio);
      img_GO.position.x -= img_GO.width/2;
      img_GO.animations.add('start',[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],30,false);
      img_GO.animations.play('start');
        setTimeout(function() {
            // pop_GO = game.add.tween(img_GO.scale).to( { x: 0, y: 0 }, 10, Phaser.Easing.Elastic.In, true);
            img_GO.destroy();
            gameStart();
        }, millisecondsToWait);
    }

    function count_1(millisecondsToWait, ratio) {
      a_123.play();
        img_1 = game.add.sprite(game.world.centerX,game.world.height/5,'img_1');
        img_1.scale.setTo(scaleRatio,scaleRatio);
        img_1.position.x -= img_1.width/2;
        img_1.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_1.animations.play('start');
        setTimeout(function() {
          img_1.destroy();
          count_GO(millisecondsToWait);
        }, millisecondsToWait);
    }

    function count_2(millisecondsToWait, ratio) {
      a_123.play();
        img_2 = game.add.sprite(game.world.centerX,game.world.height/5,'img_2');
        img_2.scale.setTo(scaleRatio,scaleRatio);
        img_2.position.x -= img_2.width/2;
        img_2.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_2.animations.play('start');
        setTimeout(function() {
          img_2.destroy();
          count_1(millisecondsToWait);
        }, millisecondsToWait);
    }

    function count_3(millisecondsToWait, ratio) {
        a_123.play();
        img_3 = game.add.sprite(game.world.centerX,game.world.height/5,'img_3');
        img_3.scale.setTo(scaleRatio,scaleRatio);
        img_3.position.x -= img_3.width/2;
        img_3.animations.add('start',[0,1,2,3,4,5,6,7,8,9],30,false);
        img_3.animations.play('start');
        setTimeout(function() {
            img_3.destroy();
            count_2(millisecondsToWait);
        }, millisecondsToWait);
    }

    function popupCount() {
        var millisecondsToWait = 1000;
        //var ratio=2;

        //count_3(millisecondsToWait,ratio);
        count_3(millisecondsToWait);
    }

    function gameStart() {
      a_game_bgm.play();
        for (var i = 0; i < game.width / 10; i++) {
            var rowBox = box.create(i * 10, 80, "box");
            rowBox.body.immovable = true; // box가 움직이지 못하도록 설정
            rowBox = box.create(i * 10, game.height - 10, "box");
            rowBox.body.immovable = true; // box가 움직이지 못하도록 설정
        }
        for (var j = 9; j < game.height / 10; j++) {
            var colBox = box.create(0, j * 10, "box");
            colBox.body.immovable = true; // box가 움직이지 못하도록 설정
            colBox = box.create(game.width - 10, j * 10, "box");
            colBox.body.immovable = true; // box가 움직이지 못하도록 설정
        }

        /* 플레이어 추가 */
        player = game.add.sprite((game.width) / 2, (game.height) / 2, "player");
        player.scale.setTo(0.5, 0.5);
        game.physics.arcade.enable(player);
        // 평상시 뛰는 애니메이션
        player.animations.add("run", [0, 1, 2, 3, 4, 5, 6, 7], 10, true);
        // 긍정적 아이템 습득시 애니메이션
        player.animations.add("good", [9], 10, false);
        // 부정적 아이템 습득시 애니메이션
        player.animations.add("bad", [8], 10, false);

        enemy.enableBody = true;
        enemy.physicsBodyType = Phaser.Physics.ARCADE;


        /* 아이템 미리 로드 */
        var preEasyArr = [];
        var easyArr = [];
        var preHardArr = [];
        var hardArr = [];

        /*
          EASY MODE GOOD ITEMS
        */

        //초록두부
        for (var i = 0; i < 5; i++) {
            var cache = game.cache.getImage("g_obj_01").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_01");
            item.visible = false;
            item['score']=1;
            preEasyArr.push(item);
        }
        //초록만두
        for (var i = 0; i < 5; i++) {
            var cache = game.cache.getImage("g_obj_03").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_03");
            item.visible = false;
            item['score']=1;
            preEasyArr.push(item);
        }
        //초록소금
        for (var i = 0; i < 5; i++) {
            var cache = game.cache.getImage("g_obj_05").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_05");
            item.visible = false;
            item['score']=1;
            preEasyArr.push(item);
        }
        //초록 액티비아
        for (var i = 0; i < 5; i++) {
            var cache = game.cache.getImage("g_obj_07").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_07");
            item.visible = false;
            item['score']=1;
            preEasyArr.push(item);
        }
        //지담터
        for (var i = 0; i < 3; i++) {
            var cache = game.cache.getImage("jadamteo").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item['score']=2;
            preEasyArr.push(item);
        }

        /*
          EASY MODE BAD ITEMS
        */

        //검정두부
        for (var i = 0; i < 2; i++) {
            var cache = game.cache.getImage("g_obj_02").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_02");
            item.visible = false;
            item['score']=-2;
            preEasyArr.push(item);
        }
        //검정만두
        for (var i = 0; i < 2; i++) {
            var cache = game.cache.getImage("g_obj_04").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_04");
            item.visible = false;
            item['score']=-1;

            preEasyArr.push(item);
        }
        //검정소금
        for (var i = 0; i < 2; i++) {
            var cache = game.cache.getImage("g_obj_06").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_06");
            item.visible = false;
            item['score']=-1;

            preEasyArr.push(item);
        }
        //검정 액티비아
        for (var i = 0; i < 2; i++) {
            var cache = game.cache.getImage("g_obj_08").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_08");
            item.visible = false;
            item['score']=-1;

            preEasyArr.push(item);
        }

        /*
          >>>>> HARD MODE GOOD ITEMS <<<<<<
        */

        //초록두부
        for (var i = 0; i < 25; i++) {
            var cache = game.cache.getImage("g_obj_01").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_01");
            item.visible = false;
            item['score']=1;
            preHardArr.push(item);
        }
        //초록만두
        for (var i = 0; i < 25; i++) {
            var cache = game.cache.getImage("g_obj_03").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_03");
            item.visible = false;
            item['score']=1;
            preHardArr.push(item);
        }
        //초록소금
        for (var i = 0; i < 25; i++) {
            var cache = game.cache.getImage("g_obj_05").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_05");
            item.visible = false;
            item['score']=1;
            preHardArr.push(item);
        }
        //초록 액티비아
        for (var i = 0; i < 25; i++) {
            var cache = game.cache.getImage("g_obj_07").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_07");
            item.visible = false;
            item['score']=1;
            preHardArr.push(item);
        }
        //지담터
        for (var i = 0; i < 10; i++) {
            var cache = game.cache.getImage("jadamteo").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "jadamteo");
            item.visible = false;
            item['score']=2;
            preHardArr.push(item);
        }

        /*
          >>>>> HARD MODE BAD ITEMS <<<<<<
        */

        //검정두부
        for (var i = 0; i < 6; i++) {
            var cache = game.cache.getImage("g_obj_02").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_02");
            item.visible = false;
            item['score']=-1;
            preHardArr.push(item);
        }
        //검정만두
        for (var i = 0; i < 6; i++) {
            var cache = game.cache.getImage("g_obj_04").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_04");
            item.visible = false;
            item['score']=-1;

            preHardArr.push(item);
        }
        //검정소금
        for (var i = 0; i < 6; i++) {
            var cache = game.cache.getImage("g_obj_06").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_06");
            item.visible = false;
            item['score']=-1;

            preHardArr.push(item);
        }
        //검정 액티비아
        for (var i = 0; i < 6; i++) {
            var cache = game.cache.getImage("g_obj_08").width;
            var x = game.rnd.integerInRange(10, game.width - (cache + 10));
            var item = enemy.create(x, 80, "g_obj_08");
            item.visible = false;
            item['score']=-1;

            preHardArr.push(item);
        }


        /*
          SHUFFLE ITEM ARRAY
        */
        easyArr = shuffleArray(preEasyArr);
        hardArr = shuffleArray(preHardArr);

        var i = 0;
        /* 아이템 낙하 */
        easyMode = setInterval(
            function() {
              if (i == easyArr.length) {
                hard=true;
                i=0;
                destroy(easyMode);
              } else {
                var item = easyArr[i];
                item.visible = true;
                game.physics.arcade.moveToXY(item, item.x, game.height, 150);
                i++;
              }
            }, 1290
        );

        hardMode = setInterval(
            function() {
              if(hard) {
                if (i == hardArr.length) {
                  hard=true;
                  i=0;
                  destroy(hardMode);
                } else {
                  var item = hardArr[i];
                  item.visible = true;
                  game.physics.arcade.moveToXY(item, item.x, game.height, 300);
                  i++;
                }
              }

            }, 597
        );

        enemy.setAll("outOfBoundsKill", true);
        enemy.setAll("checkWorldBounds", true);

        txtScore.visible = true;

        // start the timer
        timer.start();

    }

    /**
     * Randomize array element order in-place.
     * Using Durstenfeld shuffle algorithm.
     */
    function shuffleArray(array) {
        for (var i = array.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var temp = array[i];
            array[i] = array[j];
            array[j] = temp;
        }
        return array;
    }

    /**
     * Returns a random integer between min (inclusive) and max (inclusive)
     * Using Math.round() will give you a non-uniform distribution!
     */
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function destroy(i) {
      clearInterval(i);
    }
</script>

</html>
